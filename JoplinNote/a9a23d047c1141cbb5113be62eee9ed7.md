2.3.1 架构和策略

输入：用户特征、物品特征、用户和物品的统计特征、场景特征

## 1. 多目标模型

排序模型预估每个指标（点击率、点赞率、收藏率、转发率）建立一个预测， 之后融合这些预估分数，然后对分数进行截断过滤。![image.png](:/e0923f1099c54878afdf7eabf5fe7cda)


模型训练时候类别不平衡比较常见，负样本过多。使用负样本降采样提高训练速度。由于负样本降采样，点击率会虚高。设下采样概率为$\alpha$, 正负样本数量分别为$n^+, n^-$，那么真实点击率为$p_{true} = \frac{n_+}{n_+ + n_-}$，预估的点击率为$p_{pred}=\frac{n_+}{n_++\alpha n_-}$, 由此可以推导出校准公式$p_{true}=\frac{\alpha\cdot p_{pred}}{(1-p_{pred})+\alpha\cdot p_{pred}}$[Practical lessons from predicting clicks on ads at Facebook], 线上最终的输出就是采用这个式子的结果


## 2. Multi-gate Mixture-of-Experts (MMoE)

一种多目标排序模型。MMoE 用多个独立的塔提取特征，并对多塔提取的特征向量做加权平均，然后送入多头。MMoE 的训练softmax导出的门机制向量容易出现极化现象（polarize），可以用 dropout 解决。![image.png](:/e00ddeab3f614879aa11a363cc34be00)

用softmax计算得到不同专家网络的权重调控得到不同任务上的输入

Modeling task relationships in multi-task learning with multi-gate mixture of experts  
Recommending what video to watch next: a multitask ranking system


## 3. 预估分数融合

$w, \alpha,\beta$均为超参数

* 简单的加权和：$p_{click}+w_1\cdot p_{like}+w_2\cdot p_{collect} + \cdots$
* 点击率乘以其他项的加权和: $p_{click}\cdot (1 + w_1 \cdot p_{like} + w_2\cdot p_{collect}+\cdots)$
* 某国外短视频APP融分公式：$(1+w_1\cdot p_{time})^{\alpha_1}\cdot(1+w_2\cdot p_{like})^{\alpha_2}\cdots$
* 某国内短视频APP的融合公式：根据预估时长$p_{time}$对$n$个候选视频排序，如果某视频排名$r_{time}$，则它的得分为$\frac{1}{r_{time}^\alpha+\beta}$, 对点击、点赞、转发、评论等预估分数做类似处理，最后融合$\frac{w_1}{r_{time}^{\alpha_1}+\beta_1}+\frac{w_2}{r_{click}^{\alpha_2}+\beta_2}+\cdots$
* 某电商融分公式：转化流程是曝光、点击、加购物车和付款。模型预估$p_{click}, p_{cart}, p_{pay}$, 最后融合分数$p_{click}^{\alpha_1} \cdot p_{cart}^{\alpha_2}\cdot p_{pay}^{\alpha_3}$


## 4. 视频建模

图文笔记排序的主要依据：点击、点赞、收藏、转发

视频排序主要依据：播放时长和完播率[deep neural networks for Youtube recommendations].

* 播放时长：$p=\frac{exp(z)}{1+exp(z)} = \frac{t}{1+t}$，$t$为播放时长，训练时候拟合这个式子，线上预估则直接计算$exp(z)$作为播放时长预估值

* 完播率：

  * 连续建模：视频时长为10分钟，实际播放4分钟，完播率0.4，模型拟合概率即可。
  * 截断建模：设定一个阈值对视频进行二分类，例如10分钟的视频大于8分钟即认为完播，否则没有完播

融分公式：完播率不能直接加入融分公式，因为完播率对于长视频不太公平，考虑$p_{finish} = \frac{预估完播率}{f(视频长度)}$，其中分母函数一般为视频长度的负相关函数


## 5. 小红书三塔粗排模型

COLD：Towards the next generation of pre-ranking system

用户塔（用户+场景、半动态）、物品塔（物品，静态）、交叉塔（统计交叉塔，动态）


id: a9a23d047c1141cbb5113be62eee9ed7
parent_id: 03165f479e854c2ba1640e475e741709
created_time: 2023-03-25T10:09:45.287Z
updated_time: 2023-03-31T12:47:39.565Z
is_conflict: 0
latitude: 0.00000000
longitude: 0.00000000
altitude: 0.0000
author: 
source_url: 
is_todo: 0
todo_due: 0
todo_completed: 0
source: joplin-desktop
source_application: net.cozic.joplin-desktop
application_data: 
order: 1680266859080
user_created_time: 2023-03-25T10:09:45.287Z
user_updated_time: 2023-03-31T12:47:39.565Z
encryption_cipher_text: 
encryption_applied: 0
markup_language: 1
is_shared: 0
share_id: 
conflict_original_id: 
master_key_id: 
user_data: 
type_: 1