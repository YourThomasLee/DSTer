2.3.1 协同过滤

普通的通过用户-物品共现矩阵的方法，无法处理矩阵稀疏的问题。另外也不能在多粒度上对用户兴趣和物品进行建模。

矩阵分解方法，可以解决矩阵稀疏的问题。使用spark进行矩阵分解的代码。在模型中，我们需要在模型中指定训练样本中用户 ID 对应的列 userIdInt 和物品 ID 对应的列 movieIdInt，并且两个 ID 列对应的数据类型需要是 int 类型的。矩阵分解算法得出的结果，你完全可以把它当作 Embedding 来处理。

```python

// 建立矩阵分解模型
val als = new ALS()
  .setMaxIter(5)
  .setRegParam(0.01)
  .setUserCol("userIdInt")
  .setItemCol("movieIdInt")
  .setRatingCol("ratingFloat")

//训练模型
val model = als.fit(training)

//得到物品向量和用户向量
model.itemFactors.show(10, truncate = false)
model.userFactors.show(10, truncate = false
```

![image.png](:/671bbcc18aa44ddda0bd115d60e03a13)


id: 7f96e0995b2c4beabd37e8e5f51c72ae
parent_id: 03165f479e854c2ba1640e475e741709
created_time: 2023-03-25T10:09:45.303Z
updated_time: 2023-03-31T12:47:39.061Z
is_conflict: 0
latitude: 0.00000000
longitude: 0.00000000
altitude: 0.0000
author: 
source_url: 
is_todo: 0
todo_due: 0
todo_completed: 0
source: joplin-desktop
source_application: net.cozic.joplin-desktop
application_data: 
order: 1680266858998
user_created_time: 2023-03-25T10:09:45.303Z
user_updated_time: 2023-03-31T12:47:39.061Z
encryption_cipher_text: 
encryption_applied: 0
markup_language: 1
is_shared: 0
share_id: 
conflict_original_id: 
master_key_id: 
user_data: 
type_: 1