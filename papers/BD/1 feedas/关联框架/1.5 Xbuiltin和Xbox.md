## 名词解释

*   词表：全部检索词按字顺排列而成的有机集合，用于标引和检索文件
*   tsv: tab-seperated values，每一行存储一条记录，记录的各字段之间用tab分隔

## Xbuiltin

>   ref: [xbuiltin](http://wiki.baidu.com/pages/viewpage.action?pageId=1107686727)

### ref

本地词表

### 应用

remix初始化Env时，读取xbuiltin的conf，初始化xbuiltin =>`init_xbuiltin（）`

### 初始化: init_xbuiltin

*   调用`xbuiltin::Manager::instance().initialize_manager(_xbuiltin_conf_file)`

*   读取`feedas_dict.conf`，根据`thread_number`初始化对应数量的线程

    >   位于cts/base_env/conf/目录下

*   调用`_module_mgr->register_all_dicts`，则调用每个module的`register_dict`，构建`_dict_map`，pair类型为`<dictname, dict>`
*   调用`xbuiltin::Manager::instance().start_init_dict()`，遍历`_dict_map`，调用`dict->initialize`申请内存读取dict_file
*   多线程`Manager::load_dict`

### 使用方式

*   `conf/feedas.conf`：`#xbuiltin`定义了xbuiltin的相关配置

*   新增词表

    *   `conf/feedas_dict.conf`：增加新词表的bidword和路径
    *   `proto/xxx.proto`：定义该词表的key和value

    <img src="http://bj.bcebos.com/ibox-thumbnail98/6cbe0c256fe4837d09aa351fee2447bf?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-27T04%3A05%3A08Z%2F1800%2F%2F3cdfb666aa81ccf619f3b0c9be22c0f7bcbaeeaf5cc3a71588d7ffeb7b764876" style="zoom:50%;" >

*   词表使用：init

    <img src="http://bj.bcebos.com/ibox-thumbnail98/88925cd540fbbcec6400a72192b5e2ca?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-27T04%3A08%3A08Z%2F1800%2F%2F27df489e2fa75e0c6f06020d55b8a857506021f9d43e2eba126a84c91baea6ca">

*   其他接口API：[API说明](http://wiki.baidu.com/pages/viewpage.action?pageId=320895374)

## Xbox

>   Ref:[xbox串讲](http://wiki.baidu.com/pages/viewpage.action?pageId=202085003)

### def

将HDFS上大文件文本转换成线上实时检索服务的平台

### 存储的内容

*   query级别：用户个性化相关的表，应用方为用户个性化行为中心：UBAY

*   ad级别：存储广告维度的数据，应用方为mixer、ranker和asq等

    >   支持retrieve策略

*   feature级别：存储feature维度的数据（一条广告抽出若干feature），应用方asq、wasq

    >   ctr预估模型的需求
    >
    >   支持的策略包括dnn、无线新模型

### xbox请求

*   一个xbox请求对应一个XboxRequest

*   检索过程

    *   声明XboxRequestManager对象

    *   调用register_request完成注册

    *   根据baidu_id或cuid作为key进行查询

        >   实际使用时需要重写`fill_request`和`parse_response`

    *   调用wait_all_done

    *   不用手动clear()，完成一次检索之后自动会clear

<img src="http://bj.bcebos.com/ibox-thumbnail98/e4da8132761e46bd6cde399f5794735f?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-08-04T06%3A47%3A43Z%2F1800%2F%2Fe3e349a6f298e8001a77c245205c027ca6c7f0f92a1d2b9a43bfa791b9232773">

