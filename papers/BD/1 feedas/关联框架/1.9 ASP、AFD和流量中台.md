## 名词解释

*   **凤巢相关**
    *   ASP：凤巢流量入口
    *   router：凤巢流量实验抽样和流量分发模块
    *   VUI：凤巢渲染模块
*   **原生相关**
    *   AFD：原生流量入口
    *   tianlu：原生广告系统类ASP，负责asp日志打印和协议转换
    *   render：原生渲染模块
    *   als：原生广告交互日志，eshow
    *   xexp：爱迪生实验平台

## 流量中台一期

>   [流量中台原生](http://wiki.baidu.com/pages/viewpage.action?pageId=1217870940)

### 背景

*   **流量接入情况**
    *   搜索流量：ASP+Router
    *   推荐流量：AFD+tianlu

*   **使用情况**

    凤巢和原生广告库需要互通补余。当搜索流量需要接入原生广告时：AFD请求ASP；当推荐流量需要接入凤巢广告时：ASP请求AFD。任何一套流量接入服务要满足另外一套广告库接入的诉求，而系统适配的成本越来越高

### 旧原生广告推荐系统

>   特点：流量限制 + 联合竞价
>
>   流量限制：不适合出推荐广告的流量就直接屏蔽

<img src="http://bj.bcebos.com/ibox-thumbnail98/f8526dab89d50b1da7b7fe5a2e58247b?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-29T02%3A41%3A29Z%2F1800%2F%2F36b8c5e2f3fa8dea6d2c78cf1d58407d931ebbc6dec49e85e157e92e1d8ff91d" style="zoom:40%;" >



### 旧凤巢广告检索系统

<img src="http://bj.bcebos.com/ibox-thumbnail98/b5926465f84fd149635ec6c568c6174f?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-29T03%3A08%3A03Z%2F1800%2F%2Fc6ba3ee490c9f0f68b5fa86fc5eb4c386d82534eee410b9ea97a6f83bfc2599d" style="zoom:33%;" >

**【ASP】**

>   ref: [mixer整体流程](http://wiki.baidu.com/pages/viewpage.action?pageId=513471027)

*   接收来自PS、NS、wise的流量
    *   PS：大搜索，包括
        *   搜索推广：通过关键字搜索引导网民点击企业网站
        *   网盟推广：通过在其他优质网站设置链接引导网民
    *   NS：小频道，来自其他百度自由垂直频道（知道、tieba、hao123、百科、经验、文库等）发生的流量变现
    *   wise：无线

### 日志和报表情况

>   pk出现于多个广告库PK一个流量场景的情况，统计PK成功的日志记录

*   **客户报表**
    *   原生：以als日志为准，记录广告曝光eshow
    *   凤巢：以asp日志为准，记录出广告量show + 部分小流量PK生出的广告数
*   **内部报表**
    *   原生：afd日志统计pv + als统计eshow
    *   凤巢：show和pv

### 短期方案

>   REF: [迁移细节](http://wiki.baidu.com/pages/viewpage.action?pageId=1486567244)

*   **小频道流量（好看）打通原生广告库**
    *   afd同时请求凤巢asp和原生asp（tianlu）
    *   最后两个广告库的召回进行pk
    *   asp不再负责流量调度
*   **日志情况**
    *   afd日志：pv + win-log
    *   als日志：记录eshow
    *   凤巢asp：show
    *   天路asp：原生asp，记录曝光前进入pk环节的候选广告数
*   **客户报表**
    *   凤巢：凤巢asp + afd win-log
    *   原生：als-eshow + afd win-log

<img src="http://bj.bcebos.com/ibox-thumbnail98/b71b0648f0e14d5058c0d090c4006590?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-29T02%3A27%3A02Z%2F1800%2F%2Fab26bf9c48cdffd12db5248cce52cd34c760d8a7f4237137c3c5b76d53bd8801" style="zoom:60%;" >

### 中期方案 | 目前架构

*   **统一asp模块架构**
    *   融合凤巢asp和原生asp
    *   但是两者**独立部署，物理隔离**
*   **运作流程**
    *   天路asp：请求feedas、hipoas、mixer各个广告库
    *   afd进行pk

<img src="http://bj.bcebos.com/ibox-thumbnail98/16465efc1ede58530fa61e770a10470b?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-29T02%3A31%3A35Z%2F1800%2F%2F1bfe70899bf6b5728fcde473f3d02991b6b81928f5405c5555d36c6046d86da2" style="zoom: 40%;" >

*   **部署图**

<img src="http://bj.bcebos.com/ibox-thumbnail98/77f8e7a28ffe2a64d32449adb163e440?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-29T06%3A52%3A18Z%2F1800%2F%2F9ea86d18828bf1e8f6f51744e32aaee55f6ea9d7100fa901a275970418f3e798" style="zoom:30%;" >

### 长期方案

*   **目标**
    *   一套变现入口，架构统一，部署分开
    *   将AFD、ASP、Router、tianlu深度整合
*   **主要任务**：代码深度整合、展现日志深度整合、所有流量迁移

<img src="http://bj.bcebos.com/ibox-thumbnail98/8aa1e126db68bf41272682264dba8c0b?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-29T02%3A42%3A50Z%2F1800%2F%2F3bbad85e82c2e181c63bf4c3a1332072769938a08b07c7f7139f8b040d8dabfb" style="zoom:40%;" >

## 流量中台二期

*   **背景**

    asp和tianlu完成融合，构建流量中台fmp

*   **fmp是asp的重构**，解决asp和afd互相调用的问题

    *   Fcfmp: 替代asp请求mixer
    *   feedfmp：替代tianlu请求feedas

<img src="http://bj.bcebos.com/ibox-thumbnail98/a71ec282c977dfe7817be1935966f9c3?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-29T02%3A36%3A01Z%2F1800%2F%2F2062f53add14fd6fab181d155b70f5e28e8ea5744c2c402ae2796b4cb02a71f9" style="zoom:67%;" >

<img src="http://bj.bcebos.com/ibox-thumbnail98/c042879471f36d54b99b3d9fc05843bd?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-29T07%3A03%3A57Z%2F1800%2F%2Faa8567a3ba52b8492a04f15b5f10c8a2a29d54f27cebd1f2b7bb0927b6a2a696">

*   **功能**
    *   协议转换
    *   前置策略
    *   广告检索
    *   日志打印
*   **日志类型**
    *   Show: 展现日志
    *   asp日志：曝光前广告数
    *   烽燧日志：记录模块耗时、交互耗时等，用于构建监控体系和数据分析体系