## feedas中涉及观星的模块

*   DataManagerModule: 观星初始化

*   待补充



## 观星Q值

> Ref:
>
> * [观星q模型](http://wiki.baidu.com/pages/viewpage.action?pageId=1120469722)
> * [原生观星q](http://wiki.baidu.com/pages/viewpage.action?pageId=346200351)
> * [Q值](http://wiki.baidu.com/pages/viewpage.action?pageId=1592466703)

### 概述

*   **def**：Q值，质量度。一个广告对不同兴趣点有不同q值

*   **作用**

    *   衡量广告质量好坏
    *   广告主通过优化质量度，可以降低成本（同样出价获得更高的排名）

*   **Schema**

    *   描述数据结构、类型、相互关系的形式语言
    *   数据库中，schema定义表格、字段、关系、视图、触发器等元素
    *   包括conceptual、logical、physical三个层次

*   **每个Q包含三个维度的schemas**

    >   shcema本质是字段名列表

    *   `[..query_schemas]`：query维度的schema => 用户特征+当前上下文特征
    *   `[..pair_shcemas]`：广告维度的schema => 广告特征
    *   `[..extra_pair_schemas]`：其他广告维度的schema

### 4类q值

*   **点击率q**

    *   feedasq：预估PC端广告点击率

    *   feednnq：基于dnn预估广告点击率

    *   feedxq：预估详情页广告点击率

    *   feedtbq：贴吧流量的ctrq

    *   mtq：在点击广告的条件下，点击广告button的概率，分母是clk

    *   ubmq：在广告展现的条件下，点击广告的概率，分母是show

        >   DNN用到的特征有user用户维度、ad广告维度、context上下文维度

    *   ubmq*mtq：在广告展现条件下，点击button的概率

    *   feedusq：预估广告点击率

*   **转化率q**

    *   激活类型：下载并启动app
    *   表单类型：进入落地页填写/提交表单

*   **用户体验类q**：dislikeq、closeq

*   **广告触发annq**

    *   uesrq: 用户画像，基于user_vector计算
    *   annq: 用户特征

### 常用q值

* **Epvq**: expected pv quality, 预估流量价值

    >   另一种说法是同一流量所有q值除以样本数得到的

* **Asq**: as精排队列中广告预估的点击率，评估广告与用户匹配程度以及广告创意质量（如标题、描述等）是否高

* **bsq**: bs中预估的广告点击率，用于广告粗选，通过用户和广告两侧模型进行排序预估

* [**Clk**](http://wiki.baidu.com/pages/viewpage.action?pageId=343121282)

    * 点击质量度，描述广告点击后对落地页的满意程度，有利于打压标题党

        > 广告质量高，用户才不会经常忽视广告，而是会点一点

    * 依据：广告标题、落地页内容以及用户在落地页停留时间

* **roiq**

    * 广告转化率，在点击广告的所有用户中，成功转化的用户比率

        > 需要广告主(尤其下载类广告)通过百度api回传自己广告的转化数据

    * 可以根据广告主提供的转化数据，建模预估先验转化率 + 计算后验转化率

* **usq**

    * 用户场景模型，在进行广告排序时作为上下文信息。
    * 背景：asq预估点击率时默认各广告环境相同，但实际上排在前面的广告天然比在后面的广告有优势

* **closeq**：关闭率 = 预估用户看到视频后贴广告后的关闭率

* **scvrq**

    * ocpm计费 = obid * roiq * ctrq，当ctr高估，会导致广告转化成本提高
    * 引入展现转化率预估scvrp，令cpm=scvrq*obid，利于稳定转化成本

* **mtq**

    * 样式质量，样式会很大程度影响点击率和用户体验
    * 一般用于程序化创意，优化返回样式的质量

>   <img src="http://bj.bcebos.com/ibox-thumbnail98/24a2b554ed02d711f8b94fde6856da1b?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-26T09%3A02%3A52Z%2F1800%2F%2F1d4f09cd54f9876431ff07ce3ede5f1301907dbeb8c48cf78528ca264e380592">

>   <img src="http://bj.bcebos.com/ibox-thumbnail98/4f030a5f2765383c890a11455cdee101?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-21T07%3A42%3A16Z%2F1800%2F%2F7f1ddf0e901996e181ebc877032e8bfee4c530c13935df40211e25e21f9128eb" style="zoom:50%;" >

## 观星配置

### new_predictor_models.conf

*   feedas代码库中路径：cts/base_env/conf/new_predictor_models.conf

*   **组件**

    *   phase：用于区分当前阶段，指示用途

        >   如果以models+shcemas为一组，则一个phase可以包含多组

    *   models：指示用到的模型

    *   schemas

*   **example**

    <img src="http://bj.bcebos.com/ibox-thumbnail98/f113894787a404cb6cca6ef0997b593a?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-28T06%3A21%3A31Z%2F1800%2F%2F61397a446fe39a9ef8b96ddeff29129767669e9d979451532eb556a0a48e941f">

    

### predictor_models.conf

*   feedas代码库中路径：cts/base_env/conf/predictor_models.conf

*   **组件**
    *   q值用途
    *   q值模型
    *   q值的特征输入：query维度、广告维度和其他广告维度

*   **注意**

    *   一个query可以对应多条广告，传入时一条样本按一个query和广告ad组成的pair传入
    *   一般一次传一个query多个广告（一对多），则相当于多个pair以batch传入
    *   观星为每个样本为单位计算Q值

*   **example**

    <img src="http://bj.bcebos.com/ibox-thumbnail98/9c861b399541dd4d9475151518ed8c48?authorization=bce-auth-v1%2Ffbe74140929444858491fbf2b6bc0935%2F2021-07-28T06%3A42%3A02Z%2F1800%2F%2F4d808640652d521b0a370cf5ed184b8f1f001a502da8568cc7d93d03665ca5c8" style="zoom: 67%;" >

